# Геокодер

## Описание

Приложение позволяет получить координаты здания по адресу (прямой геокодинг или просто геокодинг) и адрес здания по
координатам (обратный геокодинг).

Работает для всех городов России (пока что только для городов с населением больше 100 тыс. человек).

## Установка зависимостей

```pip install -r requirements.txt```

## Аргументы командной строки

- ```-g, --geocoder``` - используется для [прямого] геокодинга, принимает 3 параметра: ```Город```, ```Улица```
  , ```Номер дома```.

- ```-r, --reverse``` - используется для обратного геокодинга, принимает 2 параметра ```Широта```, ```Долгота```.

- ```-a, --additional``` - вывод дополнительной информации о здании(той, что на OSM).

- ```-o, --organizations``` - вывод всех организаций в здании.

- ```-j, --json``` - вывод результатов в файл ```.json``` (в файле также будет дополнительная информация), принимает 1
  аргумент(необязательный): ```Абсолютный путь до файла```.

## Примеры запуска

```python main.py -g Ижевск Горького 68 -j```

- выведет информацию о здании, находящемся по адресу ```Удмуртия, Ижевск, улица Максима Горького, 68``` в
  файл ```.json```.

```python main.py -r 56.84477 53.20044 -a```

- выведет информацию(вместе с дополнительной) о здании, находящемуся по координатам ```56.84477, 53.20044```.

```python main.py -g Ижевск Советская 7 -j json2/myfile.json -o```

- выведет информацию(вместе с организациями) о здании, находящемся по адресу ```Удмуртия, Ижевск, улица Советская, 7```
  в файл ```.json```, находящийся по пути ```./json2/myfile.json```.

Слово ```улица, проспект, и т.д``` указывать необязательно, но может возникнуть ситуация, когда существует 2 и более
улиц с похожими названиями, например: ```Морская улица``` и ```Морская набережная```, в таком случае нужно будет указать
именно то, что вы имеете ввиду.

__Если название улицы состоит более чем из одного слова, вы можете записать его в кавычках:  
```"40 лет Победы"```, либо же, без кавычек, но и без пробелов: ```40летпобеды```.__

## Состав

- ```main.py``` - основной модуль для взаимодействия с программой.
- ```xml_parser.py``` - модуль для преобразования ```.xml(.osm)``` файлов в базу данных ```.db```.
- ```geocoder.py``` - модуль для прямой работы с геокодером.
- ```direct_geocoder.py``` - модуль для прямого геокодинга.
- ```reverse_geocoder.py``` - модуль для обратного геокодинга.
- ```organizations.py``` - модуль для нахождения организаций в здании.
- ```downloader.py``` - модуль для скачивания ```.xml``` файла нужного города с сервера OSM.
- ```output.py``` - модуль для вывода результатов работы программы на консоль или в ```.json``` файл.
- ```utils.py``` - модуль содержит методы, которые не были размещены в других модулях.
- ```db/cities.db``` - база данных, которая содержит информацию о городах, а именно название, регион и пограничную
  рамку(крайние координаты).

После запуска программы создастся две директории: ```xml``` и ```json```, в них будут храниться соответствующие файлы.

## Тесты

- ```geocoder_test.py``` - модуль с unit-тестами.

Используется библиотека ```pytest```, на данный момент покрытие по строкам составляет ~56%.

## Подробности реализации

При запуске программа сначала проверяет не существует ли база данных введённого города (либо база данных города,
которому принадлежат введённые координаты), если существует, то начинает работать с ней, иначе проверяет
наличие ```.xml``` файла нужного города, если он есть, то программа преобразует его в базу данных, а если нет, то
скачивает с сервера OSM файл и преобразует его.

В базе данных каждого города существует две таблицы: ```nodes``` с полями

- ```id```
- ```lat```
- ```lon```
- все теги (которые нашлись в ```.xml```)

и ```ways``` (сюда так же входят ```relation```, которые являются зданиями) с полями

- ```id```
- ```nodes``` (которые входят в состав)
- ```lat```
- ```lon``` (некая внутренняя точка)
- все теги (которые нашлись в ```.xml```).

Поиск по базе осуществляется средствами ```SQLite3```.
